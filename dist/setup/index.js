(()=>{"use strict";var e={294:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;var o=Object.getOwnPropertyDescriptor(t,r);if(!o||("get"in o?!t.__esModule:o.writable||o.configurable)){o={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,n,o)}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var c=this&&this.__importStar||function(){var ownKeys=function(e){ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[t.length]=r;return t};return ownKeys(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=ownKeys(e),c=0;c<r.length;c++)if(r[c]!=="default")n(t,e,r[c]);o(t,e);return t}}();var i=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function fulfilled(e){try{step(n.next(e))}catch(e){o(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){o(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:true});const a=c(r(34));const s=r(680);const u=r(730);const l=c(r(896));const f=c(r(982));function setup(){return i(this,void 0,void 0,(function*(){let e=a.getInput("version");if(e.length===0){const t=a.getInput("token",{required:true});const r=(0,u.getOctokit)(t,{baseUrl:"https://api.github.com"});const n=yield r.rest.repos.getLatestRelease({owner:"mozilla",repo:"sccache"});e=n.data.tag_name}a.info(`try to setup sccache version: ${e}`);let t=(0,s.find)("sccache",e);if(t===""){const r=yield downloadSCCache(e);if(r instanceof Error){a.setFailed(r.message);return}else{const n=getDirname(e);t=yield(0,s.cacheDir)(`${r}/${n}`,"sccache",e);a.info(`sccache cached to: ${t}`)}}else{a.info(`find sccache at: ${t}`)}a.addPath(`${t}`);a.exportVariable("SCCACHE_PATH",`${t}/sccache`);a.exportVariable("ACTIONS_CACHE_SERVICE_V2",`on`);a.exportVariable("ACTIONS_RESULTS_URL",process.env.ACTIONS_RESULTS_URL||"");a.exportVariable("ACTIONS_RUNTIME_TOKEN",process.env.ACTIONS_RUNTIME_TOKEN||"")}))}function downloadSCCache(e){return i(this,void 0,void 0,(function*(){const t=getFilename(e);const r=`https://github.com/mozilla/sccache/releases/download/${e}/${t}`;const n=`${r}.sha256`;a.info(`sccache download from url: ${r}`);const o=yield(0,s.downloadTool)(r);const c=yield(0,s.downloadTool)(n);const i=yield l.promises.readFile(o);const u=f.createHash("sha256");u.update(i);const d=u.digest("hex");const p=(yield l.promises.readFile(c)).toString().trim();if(d!==p){return Error("Checksum verification failed")}a.info(`Correct checksum: ${d}`);let h;if(getExtension()=="zip"){h=yield(0,s.extractZip)(o)}else{h=yield(0,s.extractTar)(o)}a.info(`sccache extracted to: ${h}`);return h}))}function getFilename(e){return`sccache-${e}-${getArch()}-${getPlatform()}.${getExtension()}`}function getDirname(e){return`sccache-${e}-${getArch()}-${getPlatform()}`}function getArch(){switch(process.arch){case"x64":return"x86_64";case"arm64":return"aarch64";case"arm":return"armv7";default:return Error(`Unsupported arch "${process.arch}"`)}}function getPlatform(){switch(process.platform){case"darwin":return"apple-darwin";case"win32":return"pc-windows-msvc";case"linux":if(process.arch=="arm"){return"unknown-linux-musleabi"}else{return"unknown-linux-musl"}default:return Error(`Unsupported platform "${process.platform}"`)}}function getExtension(){return"tar.gz"}setup().catch((e=>{a.error(e);a.setFailed(e.message)}))},34:e=>{e.exports=require("@actions/core")},730:e=>{e.exports=require("@actions/github")},680:e=>{e.exports=require("@actions/tool-cache")},982:e=>{e.exports=require("crypto")},896:e=>{e.exports=require("fs")}};var t={};function __nccwpck_require__(r){var n=t[r];if(n!==undefined){return n.exports}var o=t[r]={exports:{}};var c=true;try{e[r].call(o.exports,o,o.exports,__nccwpck_require__);c=false}finally{if(c)delete t[r]}return o.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var r=__nccwpck_require__(294);module.exports=r})();